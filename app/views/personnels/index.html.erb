<% provide(:title, 'All personnels') %>

<h4>All Personnels</h4>
<hr>


<div id="pagination-long"></div>

<table class="responsive-table striped" id="personnels-list">
  <thead>
    <th>name</th>
    <th>email</th>
    <th>gender</th>
    <th></th>
  </head>
  <tbody>
  </tbody>
</table>

<div id="modal-add" class="modal modal-fixed-footer modal-fixed-header">
  <%= form_for(:personnel) do |f| %>
    <div class="modal-header">
      <h5>Add personnel</h5>
    </div>
    <div class="modal-content">
      <div class="row">
        <div class="input-field col s6">
          <input id="first_name" name="personnel[first_name]" type="text" class="validate">
          <label for="first_name">First Name</label>
        </div>
        <div class="input-field col s6">
          <input id="last_name" name="personnel[last_name]" type="text" class="validate">
          <label for="last_name">Last Name</label>
        </div>
      </div>

      <div class="row">
        <div class="input-field col s12">
          <input id="email" name="personnel[email]" type="email" class="validate" required>
          <label for="email">E-mail</label>
        </div>
      </div>

      <div class="row">
        <div class="input-field col s6">
          <input id="password" name="personnel[password]" type="password" class="validate" required>
          <label for="password">Password</label>
        </div>
        <div class="input-field col s6">
          <input id="password_confirmation" name="personnel[password_confirmation]" type="password" class="validate" required>
          <label for="password_confirmation">Password confirmation</label>
        </div>
      </div>

      <div class="row">
        <div class="input-field col s6">
          <input type="text" name="personnel[department]" id="department" class="autocomplete">
          <label for="department">Department</label>
        </div>
        <div class="input-field col s6">
          <input type="checkbox" name="personnel[manager]" class="filled-in" id="manager">
          <label for="manager">Manager</label>
        </div>
      </div>

      <div class="row">
        <div class="input-field col s6">
          <input id="ssn" name="personnel[ssn]" type="text" class="validate">
          <label for="ssn">SSN</label>
        </div>
        <div class="input-field col s6">
          <input id="birth_date" name="personnel[birth_date]" type="date" class="datepicker">
          <label for="birth_date" class="active">Birth date</label>
        </div>
      </div>


      <div class="row">
        <div class="input-field col s12">
          <input name="personnel[gender\" type="radio" id="male" />
          <label for="male">Male</label>
          <input name="personnel[gender]" type="radio" id="female" />
          <label for="female">Female</label>
        </div>
      </div>

      <div class="row">
        <div class="input-field col s12">
          <input name="personnel[role]" type="radio" id="staff" value="S"required />
          <label for="staff">Staff</label>
          <input name="personnel[role]" type="radio" id="instructor" value="I" required />
          <label for="instructor">Instructor</label>
        </div>
      </div>

      <div class="row">
        <div class="input-field col s12">
          <div class="file-field input-field">
            <div class="btn">
              <span>Picture</span>
              <input type="file" name="personnel[picture]">
            </div>
            <div class="file-path-wrapper">
              <input class="file-path validate" type="text">
            </div>
          </div>
        </div>
      </div>

    </div>
    <div class="modal-footer">
      <button type="submit" class="waves-effect waves-green btn-flat">Add</button>
      <a class="modal-action modal-close waves-effect waves-red btn-flat">Cancel</a>
    </div>
  <% end %>
</div>

<div class="fixed-action-btn horizontal">
  <a data-target="modal-add" class="btn btn-floating btn-large waves-effect waves-light red">
    <i class="material-icons">add</i>
  </a>
</div>

<script>
  $(function() {
      $('input.autocomplete').autocomplete({
        data: {
          <% @departments.each do |dep| %>
            "<%= dep.name %>":null,
          <% end %>
        },
        limit: 10,
        onAutocomplete: function(val){
        },
        minLength: 1,
      });

      $('#pagination-long').materializePagination({
          align: 'center',
          lastPage: <%= @max_page %>,
          firstPage: 1,
          useUrlParameter: false,
          onClickCallback: function(requestedPage) {
            list = $('#personnels-list').find("tbody");

            list.html("");
            list.append("<tr><td colspan='4'><div class='progress'> <div class='indeterminate'></div> </div></td></tr>");

            $.ajax({
              url: '/personnels.json',
              data: {
                page: requestedPage
              },
              method: "GET",
            }).done(function(datas){

              list.html("");
              datas.forEach(function(data) {
                html = "<tr>";
                html += "<td>" + (data["first_name"] || '') + " " + (data["last_name"] || '') + "</td>";
                html += "<td>" + (data["email"] || '') + "</td>";
                html += "<td>" + (data["gender"] || '') + "</td>";
                html += "<td>";
                html += "<a href='/personnels/" + data.id + "'><i class='material-icons'>mode_edit</i></a>";
                html += "<a data-confirm='You sure?' rel='nofollow' data-method='delete' href='/personnels/" + data.id + "'><i class='material-icons'>thumb_down</i></a>";
                html += "</td>";
                html += "</tr>";
                list.append(html);

              });
            });
          }
      });
  });
</script>
